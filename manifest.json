{
  "id": "flixhq-provider",
  "name": "FlixHQ (Movies & TV)",
  "version": "1.0.0",
  "manifestURI": "https://raw.githubusercontent.com/Farqiplier/MyTestExtension/refs/heads/main/manifest.json",
  "language": "javascript",
  "type": "onlinestream-provider",
  "description": "Movies and TV Shows provider via FlixHQ - Works with everything!",
  "author": "Farqiplier",
  "lang": "en",
  "payload": "/// <reference path=\"./online-streaming-provider.d.ts\" />\n\nclass Provider {\n  constructor() {\n    this.baseUrl = \"https://api.consumet.org/movies/flixhq\";\n    this.tmdbApiKey = \"963152cd5dd145cfa7496a5e975139e9\";\n  }\n\n  getSettings() {\n    return {\n      episodeServers: [\"VidCloud\", \"UpCloud\"],\n      supportsDub: true,\n    };\n  }\n\n  async search(query) {\n    try {\n      console.log(\"[FlixHQ] Search called\");\n      \n      const title = query.media?.title?.english || query.media?.title?.romaji || query.query;\n      const year = query.media?.seasonYear;\n      const isMovie = query.media?.format === \"MOVIE\";\n      const mediaType = isMovie ? \"movie\" : \"tv\";\n      \n      console.log(`[FlixHQ] Searching: \"${title}\" (${year || \"no year\"}), type: ${mediaType}`);\n      \n      // If we have TMDB ID from Simkl, search by that\n      let tmdbId = query.media?.idMal;\n      \n      if (tmdbId && tmdbId !== 0) {\n        console.log(`[FlixHQ] Have TMDB ID from Simkl: ${tmdbId}`);\n        // FlixHQ search by title, but we can filter by year\n        const searchUrl = `${this.baseUrl}/${encodeURIComponent(title)}`;\n        const response = await fetch(searchUrl);\n        const data = await response.json();\n        \n        if (!data.results || data.results.length === 0) {\n          console.log(`[FlixHQ] No results`);\n          return [];\n        }\n        \n        // Try to match by year and type\n        let filtered = data.results;\n        if (year) {\n          filtered = filtered.filter(r => {\n            const releaseYear = r.releaseDate ? new Date(r.releaseDate).getFullYear() : null;\n            return releaseYear === year;\n          });\n        }\n        \n        // Filter by type (movie vs tv)\n        filtered = filtered.filter(r => r.type === mediaType);\n        \n        if (filtered.length === 0) {\n          filtered = data.results; // Use all if filtering removed everything\n        }\n        \n        console.log(`[FlixHQ] Found ${filtered.length} results`);\n        \n        return filtered.slice(0, 5).map(item => ({\n          id: item.id,\n          title: item.title,\n          url: item.url || \"\",\n          subOrDub: \"sub\",\n        }));\n      } else {\n        // No TMDB ID, just search by title\n        console.log(`[FlixHQ] No TMDB ID, searching by title`);\n        \n        const searchUrl = `${this.baseUrl}/${encodeURIComponent(title)}`;\n        const response = await fetch(searchUrl);\n        const data = await response.json();\n        \n        if (!data.results || data.results.length === 0) {\n          console.log(`[FlixHQ] No results`);\n          return [];\n        }\n        \n        console.log(`[FlixHQ] Found ${data.results.length} results`);\n        \n        return data.results.slice(0, 5).map(item => ({\n          id: item.id,\n          title: item.title,\n          url: item.url || \"\",\n          subOrDub: \"sub\",\n        }));\n      }\n    } catch (err) {\n      console.error(\"[FlixHQ] Search error:\", err);\n      return [];\n    }\n  }\n\n  async findEpisodes(Id) {\n    try {\n      console.log(`[FlixHQ] Getting episodes/info: ${Id}`);\n      \n      const infoUrl = `${this.baseUrl}/info?id=${Id}`;\n      const response = await fetch(infoUrl);\n      const data = await response.json();\n      \n      if (!data) {\n        console.log(`[FlixHQ] No data found`);\n        return [];\n      }\n      \n      // For movies, return single episode\n      if (data.type === \"Movie\") {\n        console.log(`[FlixHQ] This is a movie`);\n        return [{\n          id: data.episodes && data.episodes[0] ? data.episodes[0].id : Id,\n          number: 1,\n          title: data.title || \"Movie\",\n          url: \"\",\n        }];\n      }\n      \n      // For TV shows, return all episodes\n      if (!data.episodes || data.episodes.length === 0) {\n        console.log(`[FlixHQ] No episodes found`);\n        return [];\n      }\n      \n      console.log(`[FlixHQ] Found ${data.episodes.length} episodes`);\n      \n      return data.episodes.map((ep, index) => ({\n        id: ep.id,\n        number: ep.number || index + 1,\n        title: ep.title || `Episode ${ep.number || index + 1}`,\n        url: ep.url || \"\",\n      }));\n    } catch (err) {\n      console.error(\"[FlixHQ] Episodes error:\", err);\n      return [];\n    }\n  }\n\n  async findEpisodeServer(episode, server) {\n    try {\n      console.log(`[FlixHQ] Getting stream: ${episode.id}, server: ${server}`);\n      \n      // Map server names\n      const serverMap = {\n        \"VidCloud\": \"vidcloud\",\n        \"UpCloud\": \"upcloud\",\n      };\n      \n      const serverName = serverMap[server] || \"vidcloud\";\n      \n      const watchUrl = `${this.baseUrl}/watch?episodeId=${episode.id}&mediaId=${episode.id}&server=${serverName}`;\n      console.log(`[FlixHQ] Watch URL: ${watchUrl}`);\n      \n      const response = await fetch(watchUrl);\n      const data = await response.json();\n      \n      if (!data.sources || data.sources.length === 0) {\n        throw new Error(\"No sources found\");\n      }\n      \n      const source = data.sources.find(s => s.quality === \"auto\" || s.quality === \"default\") || data.sources[0];\n      \n      console.log(`[FlixHQ] Stream URL: ${source.url.substring(0, 50)}...`);\n      console.log(`[FlixHQ] This is a REAL HLS stream!`);\n      \n      // Extract subtitles\n      const subtitles = (data.subtitles || []).map((sub, index) => ({\n        id: `sub-${index}`,\n        language: sub.lang || \"Unknown\",\n        url: sub.url,\n        isDefault: sub.lang === \"English\",\n      }));\n      \n      return {\n        server: server,\n        headers: {\n          \"Referer\": \"https://flixhq.to/\",\n        },\n        videoSources: [{\n          url: source.url,\n          type: \"hls\",\n          quality: source.quality || \"auto\",\n          subtitles: subtitles,\n        }],\n      };\n    } catch (err) {\n      console.error(\"[FlixHQ] Stream error:\", err);\n      throw err;\n    }\n  }\n}"
}
