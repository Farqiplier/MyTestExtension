{
  "id": "rivestream-tmdb-provider",
  "name": "Rivestream",
  "version": "1.0.3",
  "author": "Senior Software Engineer",
  "description": "TMDB & Rivestream streaming provider.",
  "type": "onlinestream-provider",
  "language": "javascript",
  "lang": "en",
  "manifestURI": "https://raw.githubusercontent.com/Farqiplier/MyTestExtension/refs/heads/main/manifest.json",
  "payload": "class Provider {\n    constructor() {\n        this.apiKey = '963152cd5dd145cfa7496a5e975139e9';\n        this.apiUrl = 'https://api.themoviedb.org/3';\n    }\n\n    getSettings() {\n        return {\n            episodeServers: ['Rivestream'],\n            supportsDub: false\n        };\n    }\n\n    async getMediaInfo(mediaId) {\n        let id = '';\n        let type = 'tv';\n\n        if (typeof mediaId === 'object' && mediaId !== null) {\n            id = String(mediaId.tmdbId || mediaId.id);\n            type = (mediaId.type || 'tv').toLowerCase();\n        } else {\n            id = String(mediaId);\n            try {\n                const resp = await fetch(`${this.apiUrl}/movie/${id}?api_key=${this.apiKey}`);\n                const data = await resp.json();\n                type = (data && data.id) ? 'movie' : 'tv';\n            } catch (e) {\n                type = 'tv';\n            }\n        }\n        return { id, type };\n    }\n\n    async findEpisodes(mediaId) {\n        const { id, type } = await this.getMediaInfo(mediaId);\n        const episodes = [];\n\n        if (type === 'movie') {\n            episodes.push({\n                id: `${id}|movie`,\n                number: 1,\n                title: 'Full Movie'\n            });\n        } else {\n            const tvRes = await fetch(`${this.apiUrl}/tv/${id}?api_key=${this.apiKey}`).then(res => res.json());\n            if (!tvRes || !tvRes.seasons) return [];\n\n            for (const season of tvRes.seasons) {\n                if (season.season_number === 0) continue;\n                const sRes = await fetch(`${this.apiUrl}/tv/${id}/season/${season.season_number}?api_key=${this.apiKey}`).then(res => res.json());\n                if (sRes && sRes.episodes) {\n                    for (const ep of sRes.episodes) {\n                        episodes.push({\n                            id: `${id}|tv|${ep.season_number}|${ep.episode_number}`,\n                            number: episodes.length + 1,\n                            title: `S${ep.season_number} E${ep.episode_number} - ${ep.name}`\n                        });\n                    }\n                }\n            }\n        }\n        return episodes;\n    }\n\n    async findEpisodeServer(episode, server) {\n        const parts = episode.id.split('|');\n        const tmdbId = parts[0];\n        const type = parts[1];\n\n        let url = '';\n        if (type === 'movie') {\n            url = `https://rivestream.org/embed?id=${tmdbId}&type=movie`;\n        } else {\n            const s = parts[2];\n            const e = parts[3];\n            url = `https://rivestream.org/embed?id=${tmdbId}&type=tv&season=${s}&episode=${e}`;\n        }\n\n        return {\n            server: 'Rivestream',\n            videoSources: [{\n                url: url,\n                quality: 'auto',\n                type: 'iframe'\n            }]\n        };\n    }\n}\n\nnew Provider();"
}
