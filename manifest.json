{
  "id": "rivestream-simple-test",
  "name": "Rivestream (Simple Test)",
  "version": "1.0.1",
  "manifestURI": "https://raw.githubusercontent.com/Farqiplier/MyTestExtension/refs/heads/main/manifest.json",
  "language": "javascript",
  "type": "onlinestream-provider",
  "description": "Simple Rivestream test providers",
  "author": "Farqiplier",
  "lang": "en",
  "payload": "/// <reference path=\"./online-streaming-provider.d.ts\" />\n\nclass Provider {\n  constructor() {\n    this.tmdbApiKey = \"963152cd5dd145cfa7496a5e975139e9\";\n  }\n\n  getSettings() {\n    return {\n      episodeServers: [\"Rivestream\"],\n      supportsDub: false,\n    };\n  }\n\n  async search(query) {\n    try {\n      console.log(\"[Simple Test] Search called with:\", JSON.stringify(query));\n      \n      // FIXED: Handle manual match where query.media.title might not exist\n      const title = query.media?.title?.english || query.media?.title?.romaji || query.query;\n      const year = query.media?.seasonYear;\n      const isMovie = query.media?.format === \"MOVIE\";\n      const mediaType = isMovie ? \"movie\" : \"tv\";\n      \n      console.log(`[Simple Test] Searching for: \"${title}\" (${year || \"no year\"})`);\n      \n      // Try to get TMDB ID from Simkl (stored in idMal)\n      let tmdbId = query.media?.idMal;\n      \n      // If no TMDB ID from Simkl, search TMDB\n      if (!tmdbId || tmdbId === 0) {\n        console.log(\"[Simple Test] No TMDB ID from Simkl, searching TMDB...\");\n        \n        // Search TMDB\n        const searchUrl = `https://api.themoviedb.org/3/search/${mediaType}?api_key=${this.tmdbApiKey}&query=${encodeURIComponent(title)}&year=${year || \"\"}`;\n        const response = await fetch(searchUrl);\n        const data = await response.json();\n        \n        if (!data.results || data.results.length === 0) {\n          console.log(\"[Simple Test] No TMDB results\");\n          return [];\n        }\n        \n        tmdbId = data.results[0].id;\n      }\n      \n      console.log(`[Simple Test] Found TMDB ID: ${tmdbId}`);\n      \n      return [{\n        id: `${tmdbId}/${mediaType}`,\n        title: title,\n        url: `https://www.themoviedb.org/${mediaType}/${tmdbId}`,\n        subOrDub: \"sub\",\n      }];\n    } catch (err) {\n      console.error(\"[Simple Test] Search error:\", err);\n      return [];\n    }\n  }\n\n  async findEpisodes(Id) {\n    try {\n      console.log(`[Simple Test] findEpisodes: ${Id}`);\n      \n      const [tmdbId, mediaType] = Id.split(\"/\");\n      \n      if (mediaType === \"movie\") {\n        return [{ id: Id, number: 1, title: \"Movie\", url: \"\" }];\n      }\n      \n      // For TV shows, get episode count from TMDB\n      const tvUrl = `https://api.themoviedb.org/3/tv/${tmdbId}?api_key=${this.tmdbApiKey}`;\n      const response = await fetch(tvUrl);\n      const tvData = await response.json();\n      \n      if (!tvData || !tvData.number_of_seasons) {\n        console.log(\"[Simple Test] Failed to get TV data, returning 12 episodes as fallback\");\n        const episodes = [];\n        for (let i = 1; i <= 12; i++) {\n          episodes.push({\n            id: `${Id}/1/${i}`,\n            number: i,\n            title: `Episode ${i}`,\n            url: \"\",\n          });\n        }\n        return episodes;\n      }\n      \n      console.log(`[Simple Test] Found ${tvData.number_of_seasons} seasons`);\n      \n      // Get all episodes from all seasons\n      const episodes = [];\n      let absoluteEpisodeNumber = 1;\n      \n      for (let season = 1; season <= tvData.number_of_seasons; season++) {\n        const seasonUrl = `https://api.themoviedb.org/3/tv/${tmdbId}/season/${season}?api_key=${this.tmdbApiKey}`;\n        const seasonResponse = await fetch(seasonUrl);\n        const seasonData = await seasonResponse.json();\n        \n        if (!seasonData || !seasonData.episodes) continue;\n        \n        for (const ep of seasonData.episodes) {\n          episodes.push({\n            id: `${Id}/${season}/${ep.episode_number}`,\n            number: absoluteEpisodeNumber,\n            title: ep.name || `Episode ${absoluteEpisodeNumber}`,\n            url: \"\",\n          });\n          absoluteEpisodeNumber++;\n        }\n      }\n      \n      console.log(`[Simple Test] Found ${episodes.length} total episodes`);\n      return episodes;\n    } catch (err) {\n      console.error(\"[Simple Test] findEpisodes error:\", err);\n      return [];\n    }\n  }\n\n  async findEpisodeServer(episode, server) {\n    try {\n      console.log(`[Simple Test] findEpisodeServer: ${episode.id}`);\n      \n      const parts = episode.id.split(\"/\");\n      const tmdbId = parts[0];\n      const mediaType = parts[1];\n      \n      let embedUrl;\n      if (mediaType === \"movie\") {\n        embedUrl = `https://rivestream.lol/e/?tmdb=${tmdbId}&type=movie`;\n      } else {\n        const season = parts[2] || 1;\n        const ep = parts[3] || episode.number;\n        embedUrl = `https://rivestream.lol/e/?tmdb=${tmdbId}&type=tv&s=${season}&e=${ep}`;\n      }\n      \n      console.log(`[Simple Test] Embed URL: ${embedUrl}`);\n      \n      return {\n        server: server,\n        headers: {\n          \"Referer\": \"https://rivestream.lol/\",\n          \"Origin\": \"https://rivestream.lol\",\n        },\n        videoSources: [{\n          url: embedUrl,\n          type: \"iframe\",\n          quality: \"auto\",\n          subtitles: [],\n        }],\n      };\n    } catch (err) {\n      console.error(\"[Simple Test] findEpisodeServer error:\", err);\n      throw new Error(`Failed to get stream: ${err.message}`);\n    }\n  }\n}"
}
